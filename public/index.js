"use strict";var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},toConsumableArray=function(e){if(Array.isArray(e)){for(var r=0,t=Array(e.length);r<e.length;r++)t[r]=e[r];return t}return Array.from(e)},queryString=require("query-string"),transformToTernary=function(e){var r=e;return"@m_result"in e||(r={"@m_result":e,"@m_docs":{merged:{},objs:[]}}),r},getObj=function(e,r){return e["@m_docs"].objs.length||r["@m_docs"].objs.length?e["@m_docs"].objs.length?r["@m_docs"].objs.length?[].concat(e["@m_docs"].objs,r["@m_docs"].objs):[].concat(r["@m_result"],e["@m_docs"].objs):[].concat(e["@m_result"],r["@m_docs"].objs):[].concat(e["@m_result"],r["@m_result"])},getHostQuery=function(e){var r=void 0,t=e.headers.referer||e.url,o=t.indexOf("?");if(-1===r)r={};else{var n=t.slice(o);r=queryString.parse(n)}return r},ternary=function(e){var r=e.condition,t=e.iftrue,o=e.iffalse,n=transformToTernary(t),s=transformToTernary(o);return{"@m_result":r?n["@m_result"]:s["@m_result"],"@m_docs":{merged:Object.assign({},n["@m_result"],s["@m_result"],n["@m_docs"].merged,s["@m_docs"].merged),objs:getObj(n,s)}}},controllerProvider=function(e,r){return function(t,o){var n=void 0===e?"undefined":_typeof(e),s={};if("function"===n){var a=t.body,c=t.params,u=t.query,i=getHostQuery(t),l=e({body:a,params:c,query:u,hostQuery:i},t,o);s="@m_result"in l?l["@m_result"]:l}else{if("object"!==n||Array.isArray(e))throw new Error("Unacceptable type of controller: "+n+". It must be 'object' or 'function'.");s=e}setTimeout(function(){return o.json(s)},r)}},Router=require("express").Router();Router.use(function(e,r,t){r.header("Access-Control-Allow-Origin","*"),r.header("Access-Control-Allow-Headers","X-Requested-With"),t()});var createRouter=function(e){return e.forEach(function(e){var r=e.method.toLowerCase(),t=e.controller||e.json,o=e.delay||0;try{Router[r](e.url,controllerProvider(t,o))}catch(e){throw new Error(r+" is a wrong method")}}),Router};function parseObject(e){var r={};return Object.keys(e).forEach(function(t){var o=e[t],n=void 0===o?"undefined":_typeof(o);Array.isArray(o)?n=parseArray(o):null===o?n="null":"object"===n&&(n=parseObject(o)),r[t]=n}),r}function parseArray(e){var r=e[0];return r?Array.isArray(r)?parseArray(r)+"[]":"object"===(void 0===r?"undefined":_typeof(r))?[parseObject(r)]:(void 0===r?"undefined":_typeof(r))+"[]":"[]"}var isPropMandatory=function(e,r,t){var o=!1;return e.includes("null")||e.includes("undefined")?o=!1:r===t&&(o=!0),o},getMandatoryFlag=function(e){var r=e.types,t=e.matches,o=e.possibleMatches,n=e.flagIfYes,s=e.flagIfNo;return isPropMandatory(r,t,o)?n:s},findTypesObjects=function(e){return e.filter(function(e){return"object"===(void 0===e?"undefined":_typeof(e))})},findTypesNoObjects=function(e){return e.filter(function(e){return"object"!==(void 0===e?"undefined":_typeof(e))})},generateTypesWithMergedObjects=function(e){var r=findTypesObjects(e),t=e;if(r.length>1){var o=getJSONFromTernary({objs:r,merged:Object.assign.apply(Object,[{}].concat(toConsumableArray(r)))});t=[].concat(findTypesNoObjects(e),o)}return t},generateJSONValue=function(e){var r="",t=generateTypesWithMergedObjects(e).filter(function(e){return"undefined"!==e&&"null"!==e});return t.forEach(function(e,o){"object"===(void 0===e?"undefined":_typeof(e))?r+=""+JSON.stringify(e,null,2):r+=""+e,o<t.length-1&&(r+=" | ")}),r},parseStringifiedObject=function e(r){var t={};return Object.keys(r).forEach(function(o){var n=r[o];if("string"===(void 0===n?"undefined":_typeof(n)))try{var s=JSON.parse(n);"object"===(void 0===s?"undefined":_typeof(s))?t[o]=e(s):t[o]=n}catch(e){t[o]=n}else t[o]=n}),t[0]?[t[0]]:t};function getJSONFromTernary(e){var r=e.merged,t=e.objs,o={};return Object.keys(r).forEach(function(e){var r=0,n=[];t.forEach(function(t){if(e in t){var o=t[e];r+=1;var s=void 0===o?"undefined":_typeof(o);Array.isArray(o)?s=parseArray(o):null===o?s="null":"object"===(void 0===o?"undefined":_typeof(o))&&(s=parseObject(o)),n.includes(s)||n.push(s)}});var s=""+getMandatoryFlag({types:n,matches:r,possibleMatches:t.length,flagIfYes:"",flagIfNo:"?"})+e,a=generateJSONValue(n);o[s]=a}),parseStringifiedObject(o)}var getParamsFromUrl=function(e){var r={};return e.split("?")[0].split("/").filter(function(e){return e.includes(":")}).forEach(function(e){r[e.replace(":","")]=""}),r},getDataFromArray=function(e){var r={};return e.forEach(function(e){r[e]=""}),r},getArrayOfJSON=function(e){return JSON.stringify(e,null,2).replace(/\\"/g,"'").replace(/\\n/g,"\n  ").split("\n")},generateDocsFromArray=function(e){var r={language:"js",content:[]};return getArrayOfJSON(e).forEach(function(e){return r.content.push(e)}),r},generateDocsFromObject=function(e,r){var t=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:[],n=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"",s={language:"js",content:[]},a=void 0;if(Array.isArray(e))a="["+parseObject(e)+"]";else if("object"===(void 0===e?"undefined":_typeof(e)))a=parseObject(e);else{var c=e({body:r,params:getParamsFromUrl(n),query:getDataFromArray(o),hostQuery:getDataFromArray(t)});a="@m_docs"in c?getJSONFromTernary(c["@m_docs"]):parseObject(c)}return getArrayOfJSON(a).forEach(function(e){return s.content.push(e)}),s},getFileName=function(e){return e.toLocaleLowerCase().replace(new RegExp(" ","g"),"-")+".md"},generateDocumentation=function(e){var r=e.docs,t=[];return t.push({h1:r.title}),r.description&&t.push({blockquote:r.description}),t.push({h2:"Method"}),t.push({p:e.method.toLocaleUpperCase()}),t.push({h2:"URL"}),t.push({code:{language:"js",content:[e.url.split("?")[0]]}}),r.hostQuery&&(t.push({h2:"Host Query Parameters"}),t.push({blockquote:"For mock development"}),t.push({code:generateDocsFromArray(r.hostQuery)})),r.query&&(t.push({h2:"Query Parameters"}),t.push({code:generateDocsFromArray(r.query)})),r.body&&(t.push({h2:"Body"}),t.push({code:generateDocsFromObject(r.body)})),e.json?(t.push({h2:"Response"}),t.push({code:generateDocsFromObject(e.json)})):e.controller&&(t.push({h2:"Response"}),t.push({code:generateDocsFromObject(e.controller,r.body,r.hostQuery,r.query,e.url)})),{fileName:getFileName(r.fileName||r.title),fileContent:t}},bodyParser=require("body-parser"),express=require("express"),morgan=require("morgan"),_require=require("react-dev-utils/WebpackDevServerUtils"),choosePort=_require.choosePort,json2md=require("json2md"),fs=require("fs"),path=require("path"),colors=require("colors"),app=express();app.use(bodyParser.json()),app.use(morgan("dev")),app.use(function(e,r,t){"OPTIONS"===e.method?(r.header("Access-Control-Allow-Origin","*"),r.header("Access-Control-Allow-Methods","GET, PUT, POST, DELETE, OPTIONS, PATCH"),r.header("Access-Control-Allow-Headers","Content-Type, Authorization, Content-Length, X-Requested-With, X-Redmine-API-Key, X-On-Behalf-Of, __RequestVerificationToken"),r.sendStatus(200)):t()});var writeFiles=function(e,r){fs.writeFile(e,json2md(r),function(r){r?console.log(r.red):console.log("ðŸ“„ "+e)})},clearDocsFolder=function(e){try{var r=fs.readdirSync(e);Object.keys(r).forEach(function(t){var o=r[t];fs.unlinkSync(path.join(e,o))})}catch(r){"ENOENT"===r.code?console.log(("Cannot find the path: "+e).red):console.log(r)}},createDocs=function(e,r){var t=!1;e.forEach(function(e){if(e.docs){t||(clearDocsFolder(r),t=!0);var o=generateDocumentation(e),n=r+"/"+o.fileName;writeFiles(n,o.fileContent)}})},start=function(e){var r=e.routes,t=void 0===r?[]:r,o=e.defaultPort,n=void 0===o?3e3:o,s=e.docsUrl,a=void 0===s?path.resolve(process.cwd(),"docs"):s;app.use("/",createRouter(t)),choosePort("0.0.0.0",n).then(function(e){null!=e&&app.listen(e,function(){return console.log(("ðŸš€ App started on port: "+e).green)})}),createDocs(t,a)};module.exports={start:start,ternary:ternary};
//# sourceMappingURL=index.js.map
